{% extends "base.html" %}
<div class="container"><div class="row"><div class="col-sm-8 offset-sm-2">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <section class="samplebox flashes"><ul>
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul></section>
      {% endif %}
    {% endwith %}

{% block content %}

  <section class="samplebox lead">
      <h1>{{ title }}</h1>
      <form class="form-inline lead" method="POST">
        {{ form.filter_type(class = 'form-control form-control-sm') }}
        {{ form.filter_type.label }}
      </form>
  </section>
  <section class="samplebox lead">
    {% if form.filter_type.data == 'building' %}
      {% for building_code, loc_list in locations|groupby('building_code') %}

        <section class="location-group-info">
          <h2>{{ loc_list[0].building.building_name ~ ' (' ~ building_code ~ ')' }}</h2>
          <div class="location-group-info__studylocations">
            {% for location in loc_list %}
              <a class="btn btn-info" href="{{ url_for('view_location', location_id = location.location_number) }}">{{ location.location_name }}</a>
              
            {% endfor %}
          </div>
        </section>

      {% endfor %}

    {% else %}
    
      {% for category_number, loc_list in locations|groupby('category_number') %}

        <section class="location-group-info">
          <h2>{{ loc_list[0].category.type }}</h2>
          <div style='line-height:200%' class="location-group-info__studylocations">
            {% for location in loc_list %}
              <a class="btn btn-info" href="{{ url_for('view_location', location_id = location.location_number) }}">{{ location.location_name }}</a> ({{ location.building.building_name ~ ' (' ~ location.building_code ~ ')' }})
              {%- if not loop.last %},{% endif %}
            {% endfor %}
          </div>
        </section>
        
      {% endfor %}

    {% endif %}
  </section>

{% endblock %}
 </div></div></div>

{% block scripts %}

  <script>
    $(function () {
      $('#{{ form.filter_type.id }}').change(function () {
        $(this).closest('form').submit();
      });
    });
  </script>

{% endblock %}